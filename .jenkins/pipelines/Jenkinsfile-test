pipeline {
  agent {
    label  "jdk8-trigger"
  }
  libraries {
    lib('jenkins-library')
  }
  environment{
    PROJECT_NAME="fset"
  }
  stages {
    stage('Test') {
      steps {
        slackSend (channel: '#jenkins', color: '#FFFF00', message: "STARTED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
        container('jenkins-agent') {
          script {
            sh "lein do check, test, install"
          }
        }
      }
    }
  }
  post {
    success {
      slackSend (channel: '#jenkins', color: '#00FF00', message: "SUCCESSFUL: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
    }
    failure {
      slackSend (channel: '#jenkins', color: '#FF0000', message: "FAILED: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]' (${env.BUILD_URL})")
    }
    always {
      cleanWs()
    }
  }
}
